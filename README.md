# Проект: Предсказание демографических характеристик пользователей на основе просмотров видео

## Описание проекта

Этот проект направлен на создание моделей для предсказания пола и возраста пользователей, исходя из видео, которые они смотрят. Модели используют данные о названиях видео, категориях и других характеристиках, чтобы классифицировать контент по демографическим параметрам пользователей. Основные этапы работы включают разведочный анализ данных (EDA), генерацию эмбеддингов и обучение моделей машинного обучения.

### Основные этапы:
1. **Разведочный анализ данных (EDA)**  
   Исследование статистики просмотров видео и поведения пользователей. По итогам EDA сгенерированы дополнительные фичи, которые улучшают качество моделей.

2. **Генерация эмбеддингов для видео**  
   - Используются модели **SentenceTransformer** и **XLM-Roberta** для преобразования названий видео в эмбеддинги. Эти эмбеддинги служат основой для классификации видео по демографическим характеристикам пользователей.

3. **Обучение моделей**  
   - Основные модели построены с помощью **CatBoost** для предсказания пола и возраста пользователей. Модели обучаются с использованием кросс-валидации (Out-of-Fold) для повышения стабильности результатов и создания новых фичей.
   - Для предсказания пола модель классифицирует видео на три категории: предпочитаемые женщинами, мужчинами или нейтральные.
   - Предсказание возраста осуществляется как через классификацию по возрастным группам, так и через регрессию для предсказания медианного возраста.

4. **Фичи**  
    **Стат Фичи**
   
   1. **Популярность видео:**
      - Количество просмотров каждого видео (video_view_count).
      - Среднее время просмотра каждого видео (video_avg_watchtime).
   
   2. **Популярность авторов:**
      - Общее количество просмотров всех видео автора (author_view_count).
      - Среднее время просмотра видео автора (author_avg_watchtime).
   
   3. **Популярность категорий:**
      - Количество просмотров видео в каждой категории (category_view_count).
      - Среднее время просмотра видео в категории (category_avg_watchtime).
   
   4. **Взаимодействие пользователя с популярностью:**
      - Средняя популярность видео, которые смотрит пользователь.
      - Доля просмотров пользователя популярных видео.
   
   5. **Временные паттерны пользователя:**
      - Самые популярные часы и дни недели для просмотров.
      - Количество сессий пользователя (сессия — последовательность просмотров с интервалом не более 30 минут).
   
   6. **Использование устройств и платформ:**
      - Частота использования различных типов устройств.
      - Частота использования различных ОС и браузеров.
      - Количество уникальных устройств, используемых пользователем.
      - Доля каждого типа устройства в общих просмотрах.
   
   7. **Разнообразие контента:**
      - Количество уникальных категорий, которые смотрит пользователь.
      - Энтропия распределения категорий (измеряет разнообразие интересов пользователя).
   
   8. **Соотношение времени просмотра к длительности видео:**
      - Среднее отношение времени просмотра к длительности видео (watchtime_ratio).
   
   9. **Региональные предпочтения:**
      - Соответствие региона пользователя с регионами популярности просмотренных видео.
      - Количество уникальных регионов, из которых пользователь смотрит видео.
      - Доля просмотров из домашнего региона пользователя.
   
   10. **Отношение к длительности видео:**
       - Предпочтения пользователя по длительности видео: средняя длительность видео, которые пользователь смотрит.
       - Стандартное отклонение длительности видео: показатель разнообразия длительностей видео, которые смотрит пользователь.
   
   11. **Вовлеченность пользователя:**
       - Коэффициент завершения просмотра: среднее отношение total_watchtime к duration для каждого пользователя.
       - Доля видео, просмотренных более чем на 75%.
   
   12. **Поведенческие паттерны:**
       - Среднее время между событиями: указывает на частоту активности пользователя.
       - Стандартное отклонение времени между событиями: показатель регулярности активности.
   
   13. **Повторные просмотры:**
       - Количество уникальных видео, просмотренных более одного раза.
       - Доля повторных просмотров в общих просмотрах.
   
     **Фичи на базе распределения возрастных категорий по просматриваемым видео**
   Идея заключается в определении, какая возрастная категория чаще всего смотрит конкретное видео, и на основе этого предположить возраст пользователя.
   
     **Фичи, рассчитанные на базе названий видео**
   Названия видео преобразованы в эмбеддинги с помощью моделей multilingual-e5 и xlm-roberta-large. Эти эмбеддинги используются в промежуточных моделях LogisticRegression и CatBoost для генерации дополнительных фичей на основе названия видео и категорий.
     **Фичи на основе прогнозов**
   Используется кросс-валидация (Out-of-Fold) для создания надежных фичей на основе прогнозов моделей. Обучение происходит через кросс-валидацию. Для генерации новых фичей на том же датасете, на котором будет обучение, модель не использует те же данные для обучения на каждой части данных, на которых создаются новые фичи (out-of-fold предсказания).

## Результаты:
- **ROC-AUC до 0.92** для классификации пола и **0.87** для предсказания возраста у пользователей, которые просмотрели более 6 видео.
- Модели продемонстрировали высокую стабильность и точность на всех фолдах кросс-валидации.

## Структура репозитория

- `EDA_v1.ipynb`, `EDA_v2.ipynb`: файлы для разведочного анализа данных.
- `SentenceTransformer.ipynb`: модель для генерации эмбеддингов видео на основе названий с использованием модели `intfloat/multilingual-e5-small`.
- `videotitle_baseline_v2.ipynb`: обучение линейных моделей для предсказания пола и возраста на основе эмбеддингов от **XLM-Roberta**.
- `baseline_v6.ipynb`: основной файл для обучения финальных моделей с использованием CatBoost для предсказания пола и возраста.
- Результаты моделей хранятся в файлах `video_info_v2_emb_E5.parquet`, `cv_TRAIN_category_users_df.csv`, `cv_TRAIN_title_users_df.csv`, [`video_info_v2_emb_E5.parque`](https://disk.yandex.ru/d/z-Xm4qhGauQCFA) и других.


## Как запустить проект

1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/DimkKozhem/Skripka_CP
   ```
   
2. Установите необходимые зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Откройте и выполните ноутбуки по порядку:
   - Начните с **EDA** файлов для исследования данных.
   - Продолжите с ноутбуков, связанных с обучением эмбеддингов и моделей.

4. Запустите обучение моделей с использованием файлов 
для финальных предсказаний.

## Зависимости

- Python 3.x
- SentenceTransformer
- XLM-Roberta
- CatBoost
- pandas, numpy, scikit-learn

## Лицензия

Проект распространяется под лицензией MIT.


